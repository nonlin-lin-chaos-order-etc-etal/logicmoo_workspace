
RewriteEngine On

<IfModule mime_module>
   AddType text/html .php .phps
</IfModule>

Include /etc/apache2/conf-available/doc_root.conf

# SetEnvIfNoCase User-Agent "DuckDuckGo|Abonti|aggregator|AhrefsBot|asterias|BDCbot|BLEXBot|BuiltBotTough|Bullseye|BunnySlippers|ca\-crawler|CCBot|Cegbfeieh|CheeseBot|CherryPicker|CopyRightCheck|cosmos|Crescent|discobot|DittoSpyder|DotBot|Download Ninja|EasouSpider|EmailCollector|EmailSiphon|EmailWolf|EroCrawler|Exabot|ExtractorPro|Fasterfox|FeedBooster|Foobot|Genieo|grub\-client|Harvest|hloader|httplib|HTTrack|humanlinks|ieautodiscovery|InfoNaviRobot|IstellaBot|Java/1\.|JennyBot|k2spider|Kenjin Spider|Keyword Density/0\.9|larbin|LexiBot|libWeb" bad_bot
SetEnvIfNoCase User-Agent "LinkextractorPro|linko|LinkScan/8\.1a Unix|LinkWalker|LNSpiderguy|lwp\-trivial|magpie|Mata Hari|MaxPointCrawler|MegaIndex|Microsoft URL Control|MIIxpc|Mippin|Missigua Locator|Mister PiX|MJ12bot|moget|MSIECrawler|NetAnts" bad_bot
# SetEnvIfNoCase User-Agent "NICErsPRO|Niki\-Bot|NPBot|Nutch|Offline Explorer|Openfind|panscient\.com|PHP/5\.\{|ProPowerBot/2\.14|ProWebWalker|Python\-urllib|QueryN Metasearch|RepoMonkey|RMA|SemrushBot|SeznamBot|SISTRIX|sitecheck\.Internetseer\.com|SiteSnagger|SnapPreviewBot|Sogou|SpankBot|spanner|spbot|Spinn3r|suzuran|Szukacz/1\.4|Teleport|Telesoft|The Intraformant|TheNomad|TightTwatBot|Titan|toCrawl/UrlDispatcher|True_Robot|turingos|TurnitinBot|UbiCrawler|UnisterBot|URLy Warning|VCI|WBSearchBot|Web Downloader/6\.9|Web Image Collector|WebAuto|WebBandit|WebCopier|WebEnhancer|WebmasterWorldForumBot|WebReaper|WebSauger|Website Quester|Webster Pro|WebStripper|WebZip|Wotbox|wsr\-agent|WWW\-Collector\-E|Xenu|Zao|Zeus|ZyBORG|coccoc|Incutio|lmspider|memoryBot|SemrushBot|serf|Unknown|uptime files" bad_bot


# static html, js, images, etc. served from loolwsd
# loleaflet is the client part of Collabora Online
ProxyPass /loleaflet https://127.0.0.1:9980/loleaflet retry=0
ProxyPassReverse /loleaflet https://127.0.0.1:9980/loleaflet

# WOPI discovery URL
ProxyPass           /hosting/discovery https://127.0.0.1:9980/hosting/discovery retry=0
ProxyPassReverse    /hosting/discovery https://127.0.0.1:9980/hosting/discovery

# Capabilities
ProxyPass           /hosting/capabilities https://127.0.0.1:9980/hosting/capabilities retry=0
ProxyPassReverse    /hosting/capabilities https://127.0.0.1:9980/hosting/capabilities

# Main websocket
ProxyPassMatch           "/lool/(.*)/ws$" wss://127.0.0.1:9980/lool/$1/ws nocanon

# Admin Console websocket
ProxyPass    /lool/adminws wss://127.0.0.1:9980/lool/adminws

# Download as, Fullscreen presentation and Image upload operations
ProxyPass /lool https://127.0.0.1:9980/lool
ProxyPassReverse   /lool https://127.0.0.1:9980/lool


ProxyPass /xwiki http://localhost:18080/xwiki
ProxyPassReverse /xwiki http://localhost:18080/xwiki


ProxyPass /sites/ http://10.0.0.132:80/sites/
ProxyPassReverse /sites http://10.0.0.132:80/sites

ProxyPass /_ http://10.0.0.132:80/_
ProxyPassReverse /_ http://10.0.0.132:80/_

ProxyPass /_layouts http://10.0.0.132:80/_layouts
ProxyPassReverse /_layouts http://10.0.0.132:80/_layouts


ProxyPass /dokuwiki http://localhost:18088/dokuwiki
ProxyPassReverse /dokuwiki http://localhost:18088/dokuwiki


#ProxyPass /icons http://localhost:3020/icons
#ProxyPass /pldoc http://localhost:3020/swish/pldoc
ProxyPass /3020/ http://localhost:3020

ProxyPass /pldoc http://localhost:3020/pldoc
ProxyPass /plweb http://localhost:3020/plweb

ProxyPass /swish http://localhost:3020/swish
ProxyPass /pengine http://localhost:3020/pengine
ProxyPass /css http://localhost:3020/css
ProxyPass /help http://localhost:3020/help
ProxyPass /icons http://localhost:3020/icons
ProxyPass /js http://localhost:3020/js
ProxyPass /node_modules http://localhost:3020/node_modules
ProxyPass /oauth2/google http://localhost:3020/oauth2/google
ProxyPass /ace http://localhost:3020/ace
ProxyPass /filesystem http://localhost:3020/filesystem
ProxyPass /opt http://localhost:3020/opt

ProxyPass /cliopatria http://localhost:3020/cliopatria
ProxyPass /admin http://localhost:3020/admin
ProxyPass /browse http://localhost:3020/browse
ProxyPass /cpack http://localhost:3020/cpack
ProxyPass /home http://localhost:3020/home
ProxyPass /servlets http://localhost:3020/servlets
ProxyPass /user http://localhost:3020/user
ProxyPass /yasgui http://localhost:3020/yasgui

ProxyPassReverse /swish/icons http://localhost:3020/icons
ProxyPassReverse / http://localhost:3020
ProxyPassReverse / http://logicmoo.org:3020

#ProxyPassReverse / https://www.logicmoo.org
#ProxyPassReverse / http://www.logicmoo.org
ProxyPassReverse / https://www.swi-prolog.org
ProxyPassReverse / https://edu.swi-prolog.org
ProxyPassReverse / http://www.swi-prolog.org
ProxyPassReverse / http://edu.swi-prolog.org

#ProxyPass /filesystems http://localhost:3020/filesystems
#ProxyPass /e http://localhost:3020/e
#ProxyPass /p/ http://localhost:3020/p/
#ProxyPass /help http://localhost:3020/help


RewriteCond %{HTTP:UPGRADE} ^WebSocket$   [NC]
RewriteCond %{HTTP:CONNECTION} ^Upgrade$ [NC]
RewriteCond %{REQUEST_URI} !^/lool/.*
RewriteRule .* ws://localhost:3020%{REQUEST_URI} [P,L]

Header always set X-Frame-Options "SAMEORIGIN"


#Alias "/wiki" "/var/lib/mediawiki/"

ProxyPass /gitlab http://logicmoo.org:1082/gitlab
ProxyPassReverse /gitlab http://logicmoo.org:1082/gitlab
ProxyPass /api http://logicmoo.org:1082/gitlab/api
ProxyPassReverse /api http://logicmoo.org:1082/gitlab/api



#ProxyPassReverse /wiki/ http://wiki.cyc.com/wiki
#ProxyPassReverse /wiki/ http://wiki.cyc.com


#ProxyPassReverse / http://localhost:4088
#ProxyPassReverse / http://logicmoo.org:4088


RewriteCond %{REQUEST_URI} \.aspx [OR]
RewriteCond %{REQUEST_URI} \.axd
RewriteCond %{REQUEST_URI} !^/_.*
RewriteCond %{REQUEST_URI} !^/\.well-known/microsoft-identity-association.json
RewriteCond %{REQUEST_URI} !sites/.*
RewriteRule "^/(.*)" "http://10.0.0.132:80/$1" [P,L,E=rewritten:1,E=url:$1,QSA]


<IfModule mod_rewrite.c>
 RewriteEngine On
 # next two lines disable this rule
 RewriteCond %{REQUEST_URI} !^/index.*
 RewriteCond %{REQUEST_URI} ^/index.*
 # above two lines disable this rule
 RewriteCond %{REQUEST_URI} !^/xwiki/(.*)
 RewriteCond %{REQUEST_URI} !^/public/(.*) 
 RewriteCond %{REQUEST_URI} !^/ef/(.*) 
 RewriteCond %{REQUEST_FILENAME} !-d
 RewriteCond %{REQUEST_FILENAME} !-f
 RewriteCond %{REQUEST_FILENAME} !-l
 RewriteRule ^(.*)$ /xwiki/bin/view/Main/Search?f_type=DOCUMENT&text=$1&f_locale=en&f_locale=&r=1&f_space_facet=0\%2FMain. [QSA,L]
</IfModule>



Options Indexes FollowSymLinks  MultiViews 
<Directory />    
  Options +Indexes +FollowSymLinks +MultiViews
  AllowOverride all
  IndexOptions FancyIndexing HTMLTable
</Directory>
<Directory /var/www/html>
  Options +Indexes +FollowSymLinks +MultiViews
  AllowOverride all
  IndexOptions FancyIndexing HTMLTable
</Directory>


 # next two lines disable this rule
 RewriteCond %{REQUEST_URI} !^/index.*
 RewriteCond %{REQUEST_URI} ^/index.*
 # above two lines disable this rule

RewriteCond %{REQUEST_URI} !^/$
RewriteCond %{REQUEST_URI} !^/\.well-known/microsoft-identity-association.json
RewriteCond %{REQUEST_URI} !^/index.*
RewriteCond %{REQUEST_URI} !^/old-index.*
RewriteCond %{REQUEST_URI} !^/favicon.*
RewriteCond %{REQUEST_URI} !^/public.*
RewriteCond %{REQUEST_URI} !^/assets/.*
RewriteCond %{REQUEST_URI} !^/vendor/.*
RewriteCond %{REQUEST_URI} !^/wordpress.*
RewriteCond %{REQUEST_URI} !^/shindig.*
RewriteCond %{REQUEST_URI} !^/xw.*
RewriteCond %{REQUEST_URI} !^/do.*
RewriteCond %{REQUEST_URI} !^/cyc.*
RewriteCond %{REQUEST_URI} !^/ef.*
RewriteCond %{REQUEST_URI} !^/privacy.html
RewriteCond %{REQUEST_URI} !^/gitlab.*
RewriteCond %{REQUEST_URI} !^/wiki.*
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-l
RewriteRule "^/(.*)" "http://localhost:4480/$1" [P,L]


