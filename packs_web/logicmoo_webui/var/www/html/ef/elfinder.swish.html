<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>elFinder 2.1.x source version with PHP connector</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2" />

	<!-- Section CSS -->
	<!-- jQuery UI (REQUIRED) -->
	<link rel="stylesheet" href="jquery/jquery-ui-1.12.0.css" type="text/css">

	<!-- elfinder css -->
	<link rel="stylesheet" href="css/commands.css"    type="text/css">
	<link rel="stylesheet" href="css/common.css"      type="text/css">
	<link rel="stylesheet" href="css/contextmenu.css" type="text/css">
	<link rel="stylesheet" href="css/cwd.css"         type="text/css">
	<link rel="stylesheet" href="css/dialog.css"      type="text/css">
	<link rel="stylesheet" href="css/fonts.css"       type="text/css">
	<link rel="stylesheet" href="css/navbar.css"      type="text/css">
	<link rel="stylesheet" href="css/places.css"      type="text/css">
	<link rel="stylesheet" href="css/quicklook.css"   type="text/css">
	<link rel="stylesheet" href="css/statusbar.css"   type="text/css">
	<link rel="stylesheet" href="css/theme.css"       type="text/css">
	<link rel="stylesheet" href="css/toast.css"       type="text/css">
	<link rel="stylesheet" href="css/toolbar.css"     type="text/css">

	<!-- Section JavaScript -->
	<!-- jQuery and jQuery UI (REQUIRED) -->
	<script src="jquery/jquery-1.12.4.js" type="text/javascript" charset="utf-8"></script>
	<script src="jquery/jquery-ui-1.12.0.js" type="text/javascript" charset="utf-8"></script>

	<!-- elfinder core -->
	<script src="js/elFinder.js"></script>
	<script src="js/elFinder.version.js"></script>
	<script src="js/jquery.elfinder.js"></script>
	<script src="js/elFinder.options.js"></script>
	<script src="js/elFinder.options.netmount.js"></script>
	<script src="js/elFinder.history.js"></script>
	<script src="js/elFinder.command.js"></script>
	<script src="js/elFinder.resources.js"></script>

	<!-- elfinder dialog -->
	<script src="js/jquery.dialogelfinder.js"></script>

	<!-- elfinder default lang -->
	<script src="js/i18n/elfinder.en.js"></script>

	<!-- elfinder ui -->
	<script src="js/ui/button.js"></script>
	<script src="js/ui/contextmenu.js"></script>
	<script src="js/ui/cwd.js"></script>
	<script src="js/ui/dialog.js"></script>
	<script src="js/ui/fullscreenbutton.js"></script>
	<script src="js/ui/mkdirbutton.js"></script>
	<script src="js/ui/navbar.js"></script>
	<script src="js/ui/overlay.js"></script>
	<script src="js/ui/panel.js"></script>
	<script src="js/ui/path.js"></script>
	<script src="js/ui/places.js"></script>
	<script src="js/ui/searchbutton.js"></script>
	<script src="js/ui/sortbutton.js"></script>
	<script src="js/ui/stat.js"></script>
	<script src="js/ui/toast.js"></script>
	<script src="js/ui/toolbar.js"></script>
	<script src="js/ui/tree.js"></script>
	<script src="js/ui/uploadButton.js"></script>
	<script src="js/ui/viewbutton.js"></script>
	<script src="js/ui/workzone.js"></script>

	<!-- elfinder commands -->
	<script src="js/commands/archive.js"></script>
	<script src="js/commands/back.js"></script>
	<script src="js/commands/copy.js"></script>
	<script src="js/commands/cut.js"></script>
	<script src="js/commands/chmod.js"></script>
	<script src="js/commands/colwidth.js"></script>
	<script src="js/commands/download.js"></script>
	<script src="js/commands/duplicate.js"></script>
	<script src="js/commands/edit.js"></script>
	<script src="js/commands/extract.js"></script>
	<script src="js/commands/forward.js"></script>
	<script src="js/commands/fullscreen.js"></script>
	<script src="js/commands/getfile.js"></script>
	<script src="js/commands/help.js"></script>
	<script src="js/commands/hidden.js"></script>
	<script src="js/commands/home.js"></script>
	<script src="js/commands/info.js"></script>
	<script src="js/commands/mkdir.js"></script>
	<script src="js/commands/mkfile.js"></script>
	<script src="js/commands/netmount.js"></script>
	<script src="js/commands/open.js"></script>
	<script src="js/commands/opendir.js"></script>
	<script src="js/commands/paste.js"></script>
	<script src="js/commands/places.js"></script>
	<script src="js/commands/quicklook.js"></script>
	<script src="js/commands/quicklook.plugins.js"></script>
	<script src="js/commands/reload.js"></script>
	<script src="js/commands/rename.js"></script>
	<script src="js/commands/resize.js"></script>
	<script src="js/commands/restore.js"></script>
	<script src="js/commands/rm.js"></script>
	<script src="js/commands/search.js"></script>
	<script src="js/commands/sort.js"></script>	
	<script src="js/commands/up.js"></script>
	<script src="js/commands/upload.js"></script>
	<script src="js/commands/view.js"></script>

	<!-- elfinder languages -->
	<script src="js/i18n/elfinder.ar.js"></script>
	<script src="js/i18n/elfinder.bg.js"></script>
	<script src="js/i18n/elfinder.ca.js"></script>
	<script src="js/i18n/elfinder.cs.js"></script>
	<script src="js/i18n/elfinder.da.js"></script>
	<script src="js/i18n/elfinder.de.js"></script>
	<script src="js/i18n/elfinder.el.js"></script>
	<script src="js/i18n/elfinder.es.js"></script>
	<script src="js/i18n/elfinder.fa.js"></script>
	<script src="js/i18n/elfinder.fo.js"></script>
	<script src="js/i18n/elfinder.fr.js"></script>
	<script src="js/i18n/elfinder.he.js"></script>
	<script src="js/i18n/elfinder.hu.js"></script>
	<script src="js/i18n/elfinder.id.js"></script>
	<script src="js/i18n/elfinder.it.js"></script>
	<script src="js/i18n/elfinder.jp.js"></script>
	<script src="js/i18n/elfinder.ko.js"></script>
	<script src="js/i18n/elfinder.nl.js"></script>
	<script src="js/i18n/elfinder.no.js"></script>
	<script src="js/i18n/elfinder.pl.js"></script>
	<script src="js/i18n/elfinder.pt_BR.js"></script>
	<script src="js/i18n/elfinder.ro.js"></script>
	<script src="js/i18n/elfinder.ru.js"></script>
	<script src="js/i18n/elfinder.sk.js"></script>
	<script src="js/i18n/elfinder.sl.js"></script>
	<script src="js/i18n/elfinder.sr.js"></script>
	<script src="js/i18n/elfinder.sv.js"></script>
	<script src="js/i18n/elfinder.tr.js"></script>
	<script src="js/i18n/elfinder.uk.js"></script>
	<script src="js/i18n/elfinder.vi.js"></script>
	<script src="js/i18n/elfinder.zh_CN.js"></script>
	<script src="js/i18n/elfinder.zh_TW.js"></script>

	<!-- elfinder 1.x connector API support -->
	<script src="js/proxy/elFinderSupportVer1.js"></script>

	<!-- GoogleDocs Quicklook plugin for GoogleDrive Volume -->
	<script src="js/extras/quicklook.googledocs.js"></script>

    <script src="js/extras/editors.default.js"></script>

	<!-- elfinder initialization  -->
	<script>
      var WAZZ = null;
      var resizeTimer;
      var elf;
      $(function() {
        $(window).resize(function() {
          resizeTimer && clearTimeout(resizeTimer);
          if (!$('#elfinder').hasClass('elfinder-fullscreen')) {
            resizeTimer = setTimeout(function() {
              var h = parseInt($(window).height());
              if (h != parseInt($('#elfinder').height())) {
                elf.resize('100%', h);
              }
            }, 200);
          }
        });
        elf = $('#elfinder').elfinder({
          // Connector URL
          url: 'php/connector.minimal.php',

          height: $(window).height(),
          resizable: false,

          // Callback when a file is double-clicked
          getFileCallback: function(file) {

            var name = file.path;
            if (typeof(name) == 'undefined') {
              name = file.name;
              alert("The direcory name was missing (developer's bug) so please use 'Select' first: " + name);
            } else {
              window.parent.postMessage(name, '*');
            }
          },
  
          contextmenu: {
            // navbarfolder menu
            // navbar : ['open', '|', 'copy', 'cut', 'paste', 'duplicate', '|', 'rm', '|', 'info'],
            navbar: [
              'up', 'getfile', '|', 'open', 'edit', 'quicklook', '|', 'download', '|', 'copy', 'cut', 'paste', 'duplicate', '|',
              'rm', '|', 'edit', 'rename', 'resize', '|', 'archive', 'extract', '|', 'info'
            ],

            // current directory menu
            cwd: ['up', 'reload', 'back', '|', 'upload', 'mkdir', 'mkfile', 'paste', '|', 'info'],

            // current directory file menu
            files: [
              'up', 'getfile', '|', 'open', 'edit', 'quicklook', '|', 'download', '|', 'copy', 'cut', 'paste', 'duplicate', '|',
              'rm', '|', 'edit', 'rename', 'resize', '|', 'archive', 'extract', '|', 'info'
            ]
          },


          commandsOptions: {
            // configure value for "getFileCallback" used for editor integration
            getfile: {
              // send only URL or URL+path if false
              onlyURL: false,

              // allow to return multiple files info
              multiple: false,

              // allow to return folders info
              folders: false,

              // action after callback (close/destroy)
              oncomplete: ''
            },

            // "upload" command options.
            upload: {
              ui: 'uploadbutton'
            },

            // "quicklook" command options. For additional extensions
            quicklook: {
              autoplay: true,
              jplayer: 'extensions/jplayer'
            },

            // help dialog tabs
            help: {
              view: ['about', 'shortcuts', 'help']
            },

            // configure custom editor for file editing command
            edit: {
              editors: [

{
                // ACE Editor
                // `mimes` is not set for support everything kind of text file
                load : function(textarea) {
                    var self = this,
                        dfrd = $.Deferred(),
                        cdn  = '//cdnjs.cloudflare.com/ajax/libs/ace/1.2.5',
                        init = function() {
                            if (typeof ace === 'undefined') {
                                this.fm.loadScript([
                                    cdn+'/ace.js',
                                    cdn+'/ext-modelist.js',
                                    cdn+'/ext-settings_menu.js',
                                    cdn+'/ext-language_tools.js'
                                ], start);
                            } else {
                                start();
                            }
                        },
                        start = function() {
                            var editor, editorBase, mode,
                            ta = $(textarea),
                            taBase = ta.parent(),
                            dialog = taBase.parent(),
                            id = textarea.id + '_ace',
                            ext = self.file.name.replace(/^.+\.([^.]+)|(.+)$/, '$1$2').toLowerCase(),
                            // MIME/mode map
                            mimeMode = {
                                'text/x-php'              : 'php',
                                'application/x-php'       : 'php',
                                'text/html'               : 'html',
                                'application/xhtml+xml'   : 'html',
                                'text/javascript'         : 'javascript',
                                'application/javascript'  : 'javascript',
                                'text/css'                : 'css',
                                'text/x-c'                : 'c_cpp',
                                'text/x-csrc'             : 'c_cpp',
                                'text/x-chdr'             : 'c_cpp',
                                'text/x-c++'              : 'c_cpp',
                                'text/x-c++src'           : 'c_cpp',
                                'text/x-c++hdr'           : 'c_cpp',
                                'text/x-shellscript'      : 'sh',
                                'application/x-csh'       : 'sh',
                                'text/x-python'           : 'python',
                                'text/x-java'             : 'java',
                                'text/x-java-source'      : 'java',
                                'text/x-ruby'             : 'ruby',
                                'text/x-perl'             : 'perl',
                                'application/x-perl'      : 'perl',
                                'text/x-sql'              : 'sql',
                                'text/xml'                : 'xml',
                                'application/docbook+xml' : 'xml',
                                'application/xml'         : 'xml'
                            };
                            
                            // set basePath of ace
                            ace.config.set('basePath', cdn);
                            
                            // set base height
                            taBase.height(taBase.height());
                            
                            // detect mode
                            mode = ace.require('ace/ext/modelist').getModeForPath('/' + self.file.name).name;
                            if (mode === 'text') {
                                if (mimeMode[self.file.mime]) {
                                    mode = mimeMode[self.file.mime];
                                }
                            }

                            // show MIME:mode in title bar
                            taBase.prev().children('.elfinder-dialog-title').append(' (' + self.file.mime + ' : ' + mode.split(/[\/\\]/).pop() + ')');

                            // TextArea button and Setting button
                            $('<div class="ui-dialog-buttonset"/>').css('float', 'left')
                            .append(
                                $('<button>TextArea</button>')
                                .button()
                                .on('click', function(){
                                    if (ta.data('ace')) {
                                        ta.removeData('ace');
                                        editorBase.hide();
                                        ta.val(editor.session.getValue()).show().focus();
                                        $(this).text('AceEditor');
                                    } else {
                                        ta.data('ace', true);
                                        editorBase.show();
                                        editor.setValue(ta.hide().val(), -1);
                                        editor.focus();
                                        $(this).text('TextArea');
                                    }
                                })
                            )
                            .append(
                                $('<button>Ace editor setting</button>')
                                .button({
                                    icons: {
                                        primary: 'ui-icon-gear',
                                        secondary: 'ui-icon-triangle-1-e'
                                    },
                                    text: false
                                })
                                .on('click', function(){
                                    editor.showSettingsMenu();
                                })
                            )
                            .prependTo(taBase.next());

                            // Base node of Ace editor
                            editorBase = $('<div id="'+id+'" style="width:100%; height:100%;"/>').text(ta.val()).insertBefore(ta.hide());

                            // Ace editor configure
                            ta.data('ace', true);
                            editor = ace.edit(id);
                            ace.require('ace/ext/language_tools');
                            ace.require('ace/ext/settings_menu').init(editor);
                            editor.$blockScrolling = Infinity;
                            editor.setOptions({
                                theme: 'ace/theme/monokai',
                                mode: 'ace/mode/' + mode,
                                fontSize: '14px',
                                wrap: true,
                                enableBasicAutocompletion: true,
                                enableSnippets: true,
                                enableLiveAutocompletion: false
                            });
                            editor.commands.addCommand({
                                name : "saveFile",
                                bindKey: {
                                    win : 'Ctrl-s',
                                    mac : 'Command-s'
                                },
                                exec: function(editor) {
                                    self.doSave();
                                }
                            });
                            editor.commands.addCommand({
                                name : "closeEditor",
                                bindKey: {
                                    win : 'Ctrl-w|Ctrl-q',
                                    mac : 'Command-w|Command-q'
                                },
                                exec: function(editor) {
                                    self.doCancel();
                                }
                            });
                            
                            editor.resize();
                            
                            dfrd.resolve(editor);
                        };
                    
                    // init & start
                    init();
                    
                    return dfrd;
                },
                close : function(textarea, instance) {
                    if (instance) {
                        instance.destroy();
                        $(textarea).show();
                    }
                },
                save : function(textarea, instance) {
                    instance && $(textarea).data('ace') && (textarea.value = instance.session.getValue());
                },
                focus : function(textarea, instance) {
                    instance && $(textarea).data('ace') && instance.focus();
                },
                resize : function(textarea, instance, e, data) {
                    instance && instance.resize();
                }
            },

                {
                // TinyMCE for html file
               // mimes: ['text/html','text/html'],
               // exts: ['htm', 'html', 'xhtml'],
                load: function(textarea) {
                  debugger;
                  var dfrd = $.Deferred(),
                    init = function(loaded) {
                      var base = $(textarea).parent();
                      h = base.height(),
                        delta = base.outerHeight(true) - h;
                      // set base height
                      base.height(h);
                      // fit height function
                      textarea._setHeight = function(h) {
                        var base = $(this).parent(),
                          h = h || base.height(),
                          ctrH = 0,
                          areaH;
                        base.find('.mce-container-body:first').children('.mce-toolbar,.mce-toolbar-grp,.mce-statusbar').each(function() {
                          ctrH += $(this).outerHeight(true);
                        });
                        areaH = h - ctrH - delta;
                        base.find('.mce-edit-area iframe:first').height(areaH);
                        return areaH;
                      };
                      // TinyMCE configure
                      tinymce.init({
                        selector: '#' + textarea.id,
                        plugins: [
                          'fullpage' // require for getting full HTML
                        ],
                        init_instance_callback: function(editor) {
                          // fit height on init
                          setTimeout(function() {
                            textarea._setHeight(h);
                          }, loaded ? 0 : 500);
                          // return editor instance
                          dfrd.resolve(editor);
                        }
                      });
                    };
                  if (typeof tinymce === 'undefined') {
                    $.getScript('//cdnjs.cloudflare.com/ajax/libs/tinymce/4.6.2/tinymce.min.js', init);
                  } else {
                    init(true);
                  }
                  return dfrd;
                },

                close: function(textarea, instance) {
                  instance && tinymce.execCommand('mceRemoveEditor', false, textarea.id);
                },
                save: function(textarea, instance) {
                  instance && instance.save();
                },
                focus: function(textarea, instance) {
                  instance && instance.focus();
                },

                resize: function(textarea, instance, e, data) {
                  instance && instance.resize();
                  var self;
                  if (instance && data && typeof data.minimize !== 'undefined') {
                    // for dialog minimize function
                    if (data.minimize === 'on') {
                      // destroy on minimized
                      tinymce.execCommand('mceRemoveEditor', false, textarea.id);
                    } else {
                      // rebuild editor
                      self = this;
                      this.load(textarea).done(function(editor) {
                        self.instance = editor;
                      });
                    }
                    return;
                  }
                  // fit height to base node on dialog resize
                  textarea._setHeight();
                }
              }]
            }


          }
        }).elfinder('instance');

      });
	</script>
</head>
<body>
	<div id="elfinder"></div>
    <div id="results"></div>
    <script>
        // addEventListener support for IE8
        function bindEvent(element, eventName, eventHandler) {
            if (element.addEventListener) {
                element.addEventListener(eventName, eventHandler, false);
            } else if (element.attachEvent) {
                element.attachEvent('on' + eventName, eventHandler);
            }
        }
        // Send a message to the parent
        var sendMessage = function (msg) {
            // Make sure you are sending a string, and to stringify JSON
            window.parent.postMessage(msg, '*');
        };
        var results = document.getElementById('results');
          //  messageButton = document.getElementById('message_button');
        // Listen to messages from parent window
        //bindEvent(window, 'message', function (e){ results.innerHTML = e.data;});
        // Send random message data on every button click
       // bindEvent(messageButton, 'click', function (e) {
         //   var random = Math.random();
           // sendMessage('' + random);
        //});
    </script>
</body>
</html>
